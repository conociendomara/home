<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Conociendo Mara</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous"/>
    
    <style>
        :root {
            --bg: #0f1724;
            --card: #0b1220;
            --accent1: #ff6b6b;
            --accent2: #6bffd9;
            --glass: rgba(255,255,255,0.04);
            --glass-2: rgba(255,255,255,0.02);
            --muted: rgba(255,255,255,0.6);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: #e6f0ff;
            min-height: 100vh;
        }
        
        /* Loading indicator */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: #e6f0ff;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--accent1);
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Header */
        header {
            padding: 24px;
            display: flex;
            gap: 16px;
            align-items: center;
            justify-content: space-between;
            background: var(--card);
            border-bottom: 1px solid var(--glass-2);
        }
        
        .logo {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .logo .mark {
            width: 46px;
            height: 46px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--accent1), var(--accent2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #041017;
        }
        
        h1 {
            font-size: 18px;
            margin: 0;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .btn {
            background: var(--glass);
            border: 1px solid rgba(255,255,255,0.04);
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
            color: inherit;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            background: var(--accent1);
            color: #041017;
        }
        
        /* Main container */
        .container {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 18px;
            padding: 18px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Left panel */
        .panel {
            background: var(--card);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid var(--glass-2);
            box-shadow: 0 6px 24px rgba(2,6,23,0.6);
        }
        
        .search {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .search input {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 0;
            background: #051023;
            color: inherit;
        }
        
        .filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        
        .chip {
            padding: 8px 10px;
            border-radius: 999px;
            background: #061226;
            color: var(--muted);
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.03);
            transition: all 0.2s ease;
            font-size: 12px;
        }
        
        .chip.active {
            background: var(--accent1);
            color: #041017;
            border-color: var(--accent1);
        }
        
        .dest-list {
            display: grid;
            gap: 10px;
            max-height: 60vh;
            overflow: auto;
            padding-right: 6px;
        }
        
        .dest {
            display: flex;
            gap: 10px;
            padding: 10px;
            border-radius: 10px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
            border: 1px solid rgba(255,255,255,0.02);
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .dest:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .dest img {
            width: 64px;
            height: 64px;
            border-radius: 8px;
            object-fit: cover;
            transition: all 0.3s ease;
        }
        
        .dest img:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }
        
        .dest .meta {
            flex: 1;
        }
        
        .dest h4 {
            margin: 0;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .dest h4:hover {
            color: var(--accent1);
            text-shadow: 0 0 8px rgba(255, 107, 107, 0.5);
        }
        
        .dest p {
            margin: 4px 0 0;
            font-size: 12px;
            color: var(--muted);
        }
        
        .go-btn {
            padding: 6px 8px;
            border-radius: 8px;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            color: white;
            border: 0;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            font-weight: bold;
        }
        
        .go-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(90deg, #45a049, #4CAF50);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }
        
        /* Right panel */
        .stage {
            display: grid;
            grid-template-rows: 60px 1fr 200px;
            gap: 12px;
        }
        
        .video-wrap {
            background: var(--card);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid var(--glass-2);
            box-shadow: 0 6px 24px rgba(2,6,23,0.6);
        }
        
        .hero {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-radius: 12px;
            background: linear-gradient(90deg, rgba(107,255,217,0.06), rgba(255,107,107,0.04));
            border: 1px solid rgba(255,255,255,0.02);
        }
        
        .map-wrap {
            height: 420px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--glass-2);
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .itinerary {
            background: linear-gradient(180deg, #041226, transparent);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.02);
            min-height: 140px;
        }
        
        .itinerary h3 {
            margin: 0 0 8px 0;
        }
        
        .it-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .it-item {
            padding: 10px;
            background: #06132a;
            border-radius: 8px;
            border: 1px dashed rgba(255,255,255,0.03);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
        }
        
        .it-item:hover {
            background: #071a3a;
        }
        
        .grab {
            cursor: grab;
        }
        
        .grab:active {
            cursor: grabbing;
        }
        
        /* Footer */
        footer {
            padding: 18px;
            text-align: center;
            color: var(--muted);
            background: var(--card);
            border-top: 1px solid var(--glass-2);
        }
        
        /* Responsive */
        @media (max-width: 920px) {
            .container {
                grid-template-columns: 1fr;
                padding: 12px;
                gap: 12px;
            }
            .video-wrap video {
                height: 250px;
            }
            .stage {
                grid-template-rows: auto 1fr auto;
                gap: 12px;
            }
            .hero {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            .hero h3 {
                font-size: 16px;
            }
            .hero div {
                font-size: 12px;
            }
        }
        
        @media (max-width: 768px) {
            header {
                padding: 16px;
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
            .logo {
                justify-content: center;
            }
            .controls {
                justify-content: center;
                flex-wrap: wrap;
            }
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            .container {
                padding: 8px;
                gap: 8px;
            }
            .panel {
                padding: 12px;
            }
            .search {
                flex-direction: column;
                gap: 8px;
            }
            .search input {
                font-size: 16px; /* Evita zoom en iOS */
            }
            .filters {
                justify-content: center;
            }
            .chip {
                font-size: 11px;
                padding: 6px 8px;
            }
            .dest {
                flex-direction: column;
                text-align: center;
                gap: 8px;
            }
            .dest img {
                width: 100%;
                height: 150px;
                object-fit: cover;
            }
            .dest .meta h4 {
                font-size: 16px;
                margin-bottom: 8px;
            }
            .dest .meta p {
                font-size: 13px;
                margin-bottom: 12px;
            }
            .go-btn {
                width: 100%;
                padding: 10px;
                font-size: 14px;
            }
            .video-wrap video {
                height: 200px;
            }
            .info-panel h3 {
                font-size: 16px;
            }
            .info-panel h4 {
                font-size: 14px;
            }
            .info-panel p {
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .logo h1 {
                font-size: 16px;
            }
            .logo div {
                font-size: 11px;
            }
            .dest-list {
                max-height: 50vh;
            }
            .dest {
                padding: 12px;
            }
            .dest img {
                height: 120px;
            }
            .video-wrap video {
                height: 180px;
            }
            .stage {
                grid-template-rows: auto 1fr auto;
            }
        }
        
        /* Modal responsive */
        @media (max-width: 768px) {
            .modal-content {
                padding: 15px !important;
                margin: 5px !important;
                max-height: 98vh !important;
            }
            .modal-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            .modal-map {
                height: 200px !important;
            }
            .modal-close {
                width: 40px !important;
                height: 40px !important;
                font-size: 20px !important;
            }
            
            /* Modal de exportación responsive */
            #export-modal > div {
                margin: 10px !important;
                padding: 20px !important;
                max-width: 95% !important;
            }
            
            #export-form div[style*="grid-template-columns:1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }
            
            #export-form input, #export-form select {
                font-size: 16px !important; /* Evita zoom en iOS */
            }
        }
        
        /* Mejoras táctiles para móviles */
        @media (max-width: 768px) {
            .dest img, .dest h4 {
                -webkit-tap-highlight-color: rgba(255, 107, 107, 0.3);
                cursor: pointer;
            }
            .btn, .chip, .go-btn {
                -webkit-tap-highlight-color: rgba(255, 255, 255, 0.1);
                min-height: 44px; /* Tamaño mínimo recomendado para toques */
            }
            .dest {
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        /* Modal de video intro responsive */
        @media (max-width: 768px) {
            #intro-video-modal {
                padding: 10px !important;
            }
            #intro-video-modal > div {
                padding: 20px !important;
                max-height: 95vh !important;
            }
            #intro-video-modal h2 {
                font-size: 22px !important;
            }
            #intro-video-modal p {
                font-size: 14px !important;
            }
            #intro-video {
                height: 300px !important;
            }
            #close-intro-video {
                width: 35px !important;
                height: 35px !important;
                font-size: 18px !important;
            }
            #skip-intro-video, #continue-intro-video {
                padding: 10px 16px !important;
                font-size: 12px !important;
                margin: 5px !important;
            }
        }
        
        @media (max-width: 480px) {
            #intro-video {
                height: 250px !important;
            }
            #intro-video-modal h2 {
                font-size: 20px !important;
            }
            #intro-video-modal > div {
                padding: 15px !important;
            }
        }
        
        /* Error states */
        .error-message {
            padding: 20px;
            text-align: center;
            color: var(--accent1);
            background: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .empty-state {
            padding: 20px;
            text-align: center;
            color: var(--muted);
        }
    </style>
</head>
<body>
    <!-- Loading indicator -->
    <div id="loading">
        <div style="text-align: center">
            <div class="spinner"></div>
            <p>Cargando aplicación de turismo...</p>
        </div>
    </div>
    
    <header>
        <div class="logo">
            <div class="mark">MARA</div>
            <div>
                <h1>Conociendo Mara</h1>
                <div style="font-size:12px;color:var(--muted)">Explora los lugares, conoce sus origenes y localizacion</div>
            </div>
        </div>
        <div class="controls">
            <button class="btn" id="btn-history">Historia de Mara</button>
            <button class="btn" id="btn-theme">Modo Claro</button>
            <button class="btn" id="btn-download">Exportar itinerario</button>
        </div>
    </header>
    
    <main class="container">
        <aside class="panel">
            <div class="search">
                <input id="search" placeholder="Buscar destino (playa, montaña, ciudad...)" />
                <button class="btn" id="btn-random">Sugerir</button>
            </div>
            <div class="filters" id="filters">
                <div class="chip active" data-type="todo">Todos</div>
                <div class="chip" data-type="montana">Floras y faunas</div>
                <div class="chip" data-type="playa">Playa</div>
                 <div class="chip" data-type="cultura">Cultura</div>
            </div>
            <div class="dest-list panel" id="destinations">
                <div class="empty-state">Cargando destinos...</div>
            </div>
            
            <!-- Contenedor para videos temáticos -->
            <div id="theme-video-container" style="display:none;margin-top:15px;background:var(--card);border-radius:12px;padding:15px;border:1px solid var(--glass-2)">
                <h4 id="theme-video-title" style="margin:0 0 10px 0;color:var(--accent1)">🎬 Video Temático</h4>
                <div style="position:relative;width:100%;height:200px;border-radius:8px;overflow:hidden;background:#000">
                    <video 
                        id="theme-video"
                        controls
                        preload="metadata"
                        style="width:100%;height:100%;object-fit:cover;border:none"
                        poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMDAwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjEwMCIgcj0iMzAiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4yKSIvPgo8cGF0aCBkPSJNMTg1IDg1TDIxNSAxMDBMMTg1IDExNVY4NVoiIGZpbGw9IiNmZmZmZmYiLz4KPC9zdmc+">
                        <source id="theme-video-mp4" src="" type="video/mp4">
                        <source id="theme-video-webm" src="" type="video/webm">
                        <source id="theme-video-ogg" src="" type="video/ogg">
                        <p style="color:white;text-align:center;padding:50px">
                            Tu navegador no soporta la reproducción de video.<br>
                            <a id="theme-video-download" href="" style="color:#6bffd9">Descargar video</a>
                        </p>
                    </video>
                </div>
                <p id="theme-video-desc" style="margin:10px 0 0 0;font-size:12px;color:var(--muted);text-align:center">
                    Descubre más sobre este tema
                </p>
            </div>
            <div style="font-size: 11px; color: var(--muted); text-align: center; margin-top: 8px; padding: 8px; background: rgba(255,255,255,0.02); border-radius: 6px;">
                💡 Haz clic en la imagen o nombre para ver más información
            </div>
        </aside>

        <section class="stage">
            <div class="hero panel">
                <div>
                    <strong>Municipio Mara</strong> - Turismo y Cultura
                    <div style="font-size:13px;color:var(--muted)">Descubre los destinos turísticos de nuestro municipio</div>
                </div>
                <div class="carousel">
                    <div class="card-preview" id="preview">Vista previa del destino</div>
                </div>
            </div>

            <div class="video-wrap panel">
                <h3 style="margin-top:0;color:var(--accent1)">🎬 Conoce el Municipio Mara</h3>
                <div style="position:relative;width:100%;height:300px;border-radius:12px;overflow:hidden;background:#000">
                    <video 
                        id="mara-video"
                        controls
                        preload="metadata"
                        style="width:100%;height:100%;object-fit:cover;border:none"
                        poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjMDAwIi8+CjxjaXJjbGUgY3g9IjIwMCIgY3k9IjE1MCIgcj0iNDAiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4yKSIvPgo8cGF0aCBkPSJNMTg1IDEzNUwyMTUgMTUwTDE4NSAxNjVWMTM1WiIgZmlsbD0iI2ZmZmZmZiIvPgo8dGV4dCB4PSIyMDAiIHk9IjIwMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjZmZmZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5NdW5pY2lwaW8gTWFyYTwvdGV4dD4KPC9zdmc+">
                        <source src="videos/mara-promocional.mp4" type="video/mp4">
                        <source src="videos/mara-promocional.webm" type="video/webm">
                        <source src="videos/mara-promocional.ogg" type="video/ogg">
                        <p style="color:white;text-align:center;padding:50px">
                            Tu navegador no soporta la reproducción de video.<br>
                            <a href="videos/mara-promocional.mp4" style="color:#6bffd9">Descargar video</a>
                        </p>
                    </video>
                </div>
                <div style="margin-top:15px;padding:15px;background:rgba(255,255,255,0.02);border-radius:8px">
                    <h4 style="margin:0 0 10px 0;color:var(--accent2)">🌟 Municipio Mara</h4>
                    <p style="margin:0;font-size:13px;line-height:1.4;color:var(--muted)">
                        Tierra noble de serranías, planicies y orillas del Lago de Maracaibo. 
                        Hogar de la fusión de razas indígenas, europeas y africanas que conforman 
                        la identidad marense. Descubre nuestra rica cultura, tradiciones ancestrales 
                        y la belleza natural que Dios nos ha brindado.
                    </p>
                </div>
            </div>

            <div class="itinerary panel" id="itinerary">
                <h3>Información del Municipio</h3>
                <div style="padding: 20px; text-align: center; color: var(--muted);">
                    <p>Explora los destinos turísticos del Municipio Mara</p>
                    <p style="font-size: 12px; margin-top: 10px;">
                        Haz clic en "Exportar itinerario" para generar un PDF con información completa
                    </p>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal de Historia -->
    <!-- Modal de video principal superpuesto -->
    <div id="intro-video-modal" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:20000;display:flex;align-items:center;justify-content:center;padding:20px">
        <div style="background:var(--card);border-radius:20px;padding:30px;max-width:900px;width:100%;max-height:90vh;overflow:hidden;border:2px solid var(--accent1);position:relative">
            <button id="close-intro-video" style="position:absolute;top:15px;right:15px;background:var(--accent1);color:#041017;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;font-size:20px;z-index:20001;display:flex;align-items:center;justify-content:center">×</button>
            
            <div style="text-align:center;margin-bottom:20px">
                <h2 style="margin:0;color:var(--accent1);font-size:28px">🎬 Bienvenido a Mara</h2>
                <p style="margin:10px 0 0 0;color:var(--muted);font-size:16px">Descubre la belleza y cultura de nuestro municipio</p>
            </div>
            
            <div style="position:relative;width:100%;height:500px;border-radius:15px;overflow:hidden;background:#000">
                <video 
                    id="intro-video"
                    controls
                    autoplay
                    preload="metadata"
                    style="width:100%;height:100%;object-fit:cover;border:none"
                    poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjUwMCIgdmlld0JveD0iMCAwIDgwMCA1MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iNTAwIiBmaWxsPSIjMDAwIi8+CjxjaXJjbGUgY3g9IjQwMCIgY3k9IjI1MCIgcj0iNjAiIGZpbGw9InJnYmEoMjU1LDI1NSwyNTUsMC4yKSIvPgo8cGF0aCBkPSJNMzY1IDIyNUw0MzUgMjUwTDM2NSAyNzVWMjI1WiIgZmlsbD0iI2ZmZmZmZiIvPgo8dGV4dCB4PSI0MDAiIHk9IjM1MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjI0IiBmaWxsPSIjZmZmZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5NdW5pY2lwaW8gTWFyYTwvdGV4dD4KPC9zdmc+">
                    <source src="videos/mara-promocional.mp4" type="video/mp4">
                    <source src="videos/mara-promocional.webm" type="video/webm">
                    <source src="videos/mara-promocional.ogg" type="video/ogg">
                    <p style="color:white;text-align:center;padding:100px;font-size:18px">
                        Tu navegador no soporta la reproducción de video.<br>
                        <a href="videos/mara-promocional.mp4" style="color:#6bffd9;font-size:16px">Descargar video</a>
                    </p>
                </video>
            </div>
            
            <div style="margin-top:20px;text-align:center">
                <button id="skip-intro-video" style="background:var(--glass);color:inherit;border:1px solid rgba(255,255,255,0.2);padding:12px 24px;border-radius:25px;cursor:pointer;margin-right:10px;font-size:14px">
                    ⏭️ Saltar Video
                </button>
                <button id="continue-intro-video" style="background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#041017;border:none;padding:12px 24px;border-radius:25px;cursor:pointer;font-weight:bold;font-size:14px">
                    🚀 Continuar Explorando
                </button>
            </div>
        </div>
    </div>

    <div id="history-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;overflow:auto">
        <div style="background:var(--card);margin:20px auto;max-width:800px;border-radius:15px;padding:30px;border:1px solid var(--glass-2)">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                <h2 style="margin:0;color:var(--accent1)">🏛️ Historia y Orígenes del Municipio Mara</h2>
                <button id="close-history" style="background:var(--accent1);color:#041017;border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;font-size:16px">×</button>
            </div>
            
            <div style="line-height:1.8;color:#e6f0ff;max-height:70vh;overflow-y:auto;padding-right:10px">
                <div style="background:linear-gradient(135deg,var(--accent1),var(--accent2));padding:20px;border-radius:15px;margin-bottom:25px;text-align:center">
                    <h2 style="margin:0;color:#041017;font-size:24px">🌵✨ Mara: tierra de origen, memoria y resistencia</h2>
                    <p style="margin:10px 0 0 0;color:#041017;font-style:italic;font-size:16px">
                        "Yo soy Mara. No nací de decretos ni de mapas. Soy tierra hablada por los wayúu, soñada por los añú, y caminada por generaciones que aprendieron a vivir entre el sol ardiente y el agua silenciosa."
                    </p>
                </div>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">🪶 Mucho antes del municipio: los pueblos originarios</h3>
                <p>Antes de que existiera Venezuela como república, Mara ya era hogar de culturas milenarias. Los primeros habitantes fueron los <strong style="color:var(--accent1)">wayúu</strong>, que se asentaron en las llanuras desérticas del norte zuliano, y los <strong style="color:var(--accent1)">añú</strong>, que vivían sobre el agua en palafitos, en zonas lacustres cercanas al Lago de Maracaibo.</p>
                
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;margin:15px 0;border-left:4px solid var(--accent2)">
                    <ul style="margin:0;padding-left:20px">
                        <li>Los <strong>wayúu</strong> son conocidos por su lengua propia, su sistema matrilineal, sus tejidos coloridos y su cosmovisión profundamente ligada a la naturaleza.</li>
                        <li>Los <strong>añú</strong>, también llamados "paraujano", desarrollaron una cultura anfibia, construyendo sus casas sobre pilotes y navegando como forma de vida.</li>
                    </ul>
                </div>
                
                <p>Estas culturas no solo sobrevivieron: son el alma viva de Mara, y aún hoy sus descendientes conservan tradiciones, rituales y formas de organización comunitaria que desafían el tiempo.</p>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">🏜️ De territorio ancestral a municipio moderno</h3>
                <p>Aunque sus pueblos existían desde tiempos precolombinos, Mara fue oficialmente constituido como municipio en <strong style="color:var(--accent1)">1989</strong>, con San Rafael de El Moján como capital. Esta fundación administrativa no borró su historia: la consolidó como entidad política dentro del estado Zulia.</p>
                
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;margin:15px 0">
                    <ul style="margin:0;padding-left:20px">
                        <li>Mara forma parte del <strong>Área Metropolitana de Maracaibo</strong>, junto a los municipios Maracaibo, San Francisco y Jesús Enrique Lossada.</li>
                        <li>Tiene una superficie de <strong>3.588 km²</strong> y una población estimada de más de <strong>250.000 habitantes</strong>.</li>
                        <li>Está dividido en <strong>7 parroquias</strong>, cada una con sus propias dinámicas culturales y sociales.</li>
                    </ul>
                </div>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">Economía: entre la tierra y el esfuerzo</h3>
                <p>Mara es tierra de trabajo. Su economía se basa en la agricultura, la ganadería y el comercio local. Es productor frutícola, vitícola y avícola, con potencial para convertirse en uno de los motores económicos del Zulia.</p>
                <p>En sus campos se cultivan frutas tropicales, se cría ganado vacuno y caprino, y se desarrollan emprendimientos comunitarios.</p>
                <p>A pesar de los desafíos económicos y climáticos, el pueblo marense ha demostrado una capacidad de adaptación y resiliencia admirable.</p>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">🎭 Cultura viva: entre la fe y la fiesta</h3>
                <p>La identidad marense se expresa en sus fiestas patronales, rituales indígenas, música tradicional y arte popular. La devoción a <strong style="color:var(--accent1)">San Rafael Arcángel</strong>, patrono del municipio, se celebra con procesiones, cantos y encuentros comunitarios que mezclan lo religioso con lo festivo.</p>
                
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;margin:15px 0">
                    <ul style="margin:0;padding-left:20px">
                        <li>Las manifestaciones culturales incluyen danzas típicas, cantos en lengua wayúu, ferias artesanales y encuentros deportivos.</li>
                        <li>El arte marense es profundamente simbólico: cada tejido, cada mural, cada canción cuenta una historia de resistencia y pertenencia.</li>
                    </ul>
                </div>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">🧍‍♂️🧍‍♀️ Ser marense: más que un gentilicio</h3>
                <p>Ser marense es sentir que el polvo del camino te pertenece, que el saludo en la plaza es más que cortesía: es familia. Es saber que aunque el sol queme y el viento sacuda, hay raíces que no se arrancan.</p>
                
                <div style="background:linear-gradient(90deg,var(--accent1),var(--accent2));padding:15px;border-radius:10px;margin:15px 0;text-align:center">
                    <p style="margin:0;color:#041017;font-weight:bold;font-size:16px">
                        El gentilicio "marense" no solo identifica: honra.
                    </p>
                </div>
                
                <p>La comunidad se caracteriza por su hospitalidad, su fe, su lucha constante por el desarrollo y su orgullo por la tierra que los vio nacer.</p>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">📜 La historia contada por su gente</h3>
                <p>Aunque los registros oficiales marcan 1989 como año de fundación, la verdadera historia de Mara está en sus voces. En los cuentos que se dicen al caer la tarde, en los tejidos que narran leyendas, en los silencios que hablan más que mil discursos.</p>
                <p>Los ancianos wayúu y añú, los maestros rurales, los líderes comunitarios y los jóvenes emprendedores son los verdaderos cronistas de Mara. Su testimonio es el que debe ser escuchado, documentado y compartido.</p>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">🔥 Mara hoy: entre el polvo y la esperanza</h3>
                <p>Hoy, Mara enfrenta retos: económicos, climáticos, sociales. Pero también crea soluciones. Desde proyectos educativos hasta campañas de salud, desde emprendimientos juveniles hasta redes de apoyo indígena, el municipio se reinventa cada día.</p>
                
                <div style="background:linear-gradient(135deg,var(--accent2),var(--accent1));padding:15px;border-radius:10px;margin:15px 0;text-align:center">
                    <p style="margin:0;color:#041017;font-weight:bold;font-size:16px">
                        🌱 Cada vez que alguien siembra una semilla, enseña a un niño, cuida a un anciano o pinta una pared… Mara renace.
                    </p>
                </div>

                <h3 style="color:var(--accent2);border-bottom:2px solid var(--accent1);padding-bottom:8px">🌈 ¿Y mañana?</h3>
                <p>Mañana, Mara seguirá siendo tierra de origen. Con más historias, más luchas, más cantos. Porque no es solo un municipio: es una forma de vivir, de resistir, de amar.</p>

                <div style="background:linear-gradient(90deg,var(--accent1),var(--accent2));padding:20px;border-radius:15px;margin-top:25px;text-align:center">
                    <p style="margin:0;color:#041017;font-weight:bold;font-size:18px">
                        "Mara: donde la historia se escribe con el corazón<br>
                        y cada día es una nueva oportunidad de renacer"
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Exportación de Itinerario -->
    <div id="export-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;overflow:auto">
        <div style="background:var(--card);margin:20px auto;max-width:600px;border-radius:15px;padding:30px;border:1px solid var(--glass-2)">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                <h2 style="margin:0;color:var(--accent1)">📄 Exportar Itinerario a PDF</h2>
                <button id="close-export" style="background:var(--accent1);color:#041017;border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;font-size:16px">×</button>
            </div>
            
            <form id="export-form" style="display:grid;gap:15px">
                <!-- Información del itinerario -->
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;border-left:4px solid var(--accent2)">
                    <h3 style="margin:0 0 10px 0;color:var(--accent2)">📋 Información del Itinerario</h3>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                        <div>
                            <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Hora de Salida:</label>
                            <input type="time" id="departure-time" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                        </div>
                        <div>
                            <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Lugar de Salida:</label>
                            <input type="text" id="departure-location" placeholder="Ej: Plaza Bolivar" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                        </div>
                        <div>
                            <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Hora de Retorno:</label>
                            <input type="time" id="return-time" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                        </div>
                        <div>
                            <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Lugar de salida:</label>
                            <input type="text" id="return-location" placeholder="Ej: Planetario" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                        </div>
                    </div>
                </div>

                <!-- Información institucional -->
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;border-left:4px solid var(--accent1)">
                    <h3 style="margin:0 0 10px 0;color:var(--accent1)">🏛️ Información Institucional</h3>
                    <div style="display:grid;gap:10px">
                        <div>
                            <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Institución:</label>
                            <input type="text" id="institution" placeholder="Ej: Universidad Politécnica Territorial de Mara" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                            <div>
                                <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Encargado:</label>
                                <input type="text" id="responsible" placeholder="Nombre del encargado" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Teléfono:</label>
                                <input type="tel" id="phone" placeholder="Ej: +58 261-1234567" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                            </div>
                        </div>
                        <div>
                            <label style="display:block;margin-bottom:5px;font-size:12px;color:var(--muted)">Correo Electrónico:</label>
                            <input type="email" id="email" placeholder="Ej: contacto@institucion.edu.ve" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.1);background:#051023;color:inherit;font-size:14px" required>
                        </div>
                    </div>
                </div>

                <!-- Imagen del PDF -->
                <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;border-left:4px solid var(--accent2)">
                    <h3 style="margin:0 0 10px 0;color:var(--accent2)">🖼️ Imagen del PDF</h3>
                    <div style="margin-top:10px;text-align:center">
                        <img id="pdf-image" src="img/Ruta-turista.jpg" style="max-width:200px;max-height:150px;border-radius:8px;border:1px solid var(--glass-2);object-fit:cover">
                    </div>
                    <div style="margin-top:10px;font-size:12px;color:var(--muted);text-align:center">
                        Imagen que aparecerá en el PDF
                    </div>
                </div>

                <!-- Botones de acción -->
                <div style="display:flex;gap:10px;justify-content:center;margin-top:20px">
                    <button type="button" id="cancel-export" style="background:var(--glass);color:inherit;border:1px solid rgba(255,255,255,0.2);padding:12px 24px;border-radius:25px;cursor:pointer;font-size:14px">
                        Cancelar
                    </button>
                    <button type="submit" id="generate-pdf" style="background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#041017;border:none;padding:12px 24px;border-radius:25px;cursor:pointer;font-weight:bold;font-size:14px">
                        📄 Generar PDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        Todos los derechos reservados. UPTMA - Mojan
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
    
    <!-- jsPDF para generar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // Datos de destinos con información contextual y promocional
        const destinations = [
            {
                id: 1,
                name: 'San Rafael de El Moján (Plaza & Iglesia)',
                type: 'cultura',
                lat: 10.96205,
                lon: -71.73034,
                desc: 'Centro histórico y cultural: Plaza Bolívar, iglesia San Rafael Arcángel y vida local.',
                context: 'El corazón espiritual y cultural del Municipio Mara. Aquí convergen la fe católica traída desde España y las tradiciones indígenas locales. La Plaza Bolívar es testigo de la fusión de razas que caracteriza a los marenses: indígenas, europeos y africanos. La iglesia San Rafael Arcángel representa la esperanza y la unión de los habitantes, siendo un símbolo de la nobleza y hospitalidad que caracteriza a esta tierra.',
                virtues: ['Centro espiritual único', 'Arquitectura colonial preservada', 'Cultura mestiza auténtica', 'Tradiciones vivas'],
                img: 'img/san-rafael-mojan.jpg'
            },
            {
                id: 2,
                name: 'Puente Guajira Venezolana (Río Limón)',
                type: 'cultura',
                lat: 10.9988889,
                lon: -71.8175,
                desc: 'Puente icónico que une Mara y Páez; importante vía sobre el río Limón.',
                context: 'Símbolo de conexión y progreso del Municipio Mara. Este puente representa la unión entre pueblos hermanos y es testimonio del desarrollo de la región. Construido sobre el río Limón, conecta no solo territorios sino también culturas y tradiciones. Es un monumento al ingenio humano y a la determinación de los marenses por construir un futuro mejor.',
                virtues: ['Arquitectura moderna impresionante', 'Conexión estratégica regional', 'Vista panorámica del río', 'Símbolo de progreso'],
                img: 'img/puente-guajira.jpg'
            },
            {
                id: 3,
                name: 'Laguna de Sinamaica',
                type: 'playa',
                lat: 11.08397,
                lon: -71.85565,
                desc: 'Laguna y manglares en la costa noroccidental del Zulia; naturaleza y pesca artesanal.',
                context: 'Tesoro natural del Municipio Mara donde la naturaleza se manifiesta en su máxima expresión. Esta laguna es el hogar de una rica biodiversidad y el sustento de comunidades pesqueras ancestrales. Los manglares forman un ecosistema único que protege la costa y proporciona recursos naturales. Es un lugar donde la tradición pesquera se mantiene viva, conectando a los visitantes con las raíces culturales de los pueblos indígenas ribereños.',
                virtues: ['Ecosistema manglar único', 'Pesca artesanal tradicional', 'Biodiversidad excepcional', 'Cultura indígena viva'],
                img: 'img/laguna-sinamaica.jpg'
            },
            {
                id: 4,
                name: 'Orillas del Lago de Maracaibo',
                type: 'playa',
                lat: 10.95,
                lon: -71.75,
                desc: 'Playas y pesquerías tradicionales junto al Lago de Maracaibo, paisaje y cultura ribereña.',
                context: 'Las orillas del majestuoso Lago de Maracaibo son el alma económica y cultural del Municipio Mara. Aquí se desarrolla la pescadería ancestral que ha alimentado generaciones de marenses. Las viviendas palafíticas de origen indígena se alzan sobre las aguas como testimonio de la adaptación humana a este entorno único. El lago no es solo una fuente de subsistencia, sino un símbolo de la identidad zuliana y la riqueza natural que Dios ha brindado a esta tierra noble.',
                virtues: ['Pesca tradicional ancestral', 'Viviendas palafíticas únicas', 'Vista espectacular del lago', 'Cultura ribereña auténtica'],
                img: 'img/lago-maracaibo.jpg'
            },
          
            {
                id: 6,
                name: 'Los Médanos de Mara',
                type: 'montana',
                lat: 10.85000,
                lon: -71.75000,
                desc: 'Desierto de dunas de arena que contrasta con el paisaje lacustre del municipio.',
                context: 'Los Médanos de Mara representan uno de los ecosistemas más únicos y fascinantes del Municipio Mara. Estas dunas de arena dorada se extienden como un desierto en medio de la región lacustre, creando un contraste espectacular con las aguas del Lago de Maracaibo. Este paisaje desértico alberga una flora y fauna especializada que se ha adaptado a las condiciones extremas de sequía y calor. Los médanos son testimonio de la diversidad geográfica de Mara y ofrecen una experiencia única de conexión con la naturaleza en su forma más pura y salvaje.',
                virtues: ['Ecosistema desértico único', 'Flora y fauna especializada', 'Paisaje contrastante espectacular', 'Experiencia de aventura'],
                img: 'img/medanos-mara.jpg'
            },
            {
                id: 7,
                name: 'Los Acantilados Nigale',
                type: 'montana',
                lat: 10.92000,
                lon: -71.68000,
                desc: 'Formaciones rocosas imponentes con vistas al Lago de Maracaibo.',
                context: 'Los Acantilados Nigale son una maravilla geológica que se alza majestuosamente sobre las aguas del Lago de Maracaibo. Estas formaciones rocosas milenarias ofrecen vistas panorámicas incomparables del lago y sus alrededores. Los acantilados son hogar de una rica biodiversidad, incluyendo aves rapaces que anidan en sus grietas y vegetación que se aferra a las rocas. Este lugar es perfecto para la observación de aves, la fotografía paisajística y la contemplación de la inmensidad natural. Los acantilados representan la fuerza y la resistencia de la naturaleza, cualidades que también caracterizan al pueblo marense.',
                virtues: ['Vistas panorámicas del lago', 'Biodiversidad única', 'Formaciones geológicas impresionantes', 'Ideal para observación de aves'],
                img: 'img/acantilados-nigale.jpg'
            },
            {
                id: 8,
                name: 'El Cerro San Andrés',
                type: 'montana',
                lat: 10.95000,
                lon: -71.72000,
                desc: 'Elevación natural que ofrece vistas panorámicas y senderos de montaña.',
                context: 'El Cerro San Andrés es una elevación natural que se erige como un mirador privilegiado del Municipio Mara. Desde su cumbre se puede contemplar la inmensidad del Lago de Maracaibo, las planicies circundantes y la diversidad del paisaje marense. Este cerro es un santuario natural donde la flora y fauna local encuentran refugio, incluyendo especies endémicas de la región. Los senderos que lo atraviesan invitan a caminantes y aventureros a descubrir la belleza oculta de Mara. El Cerro San Andrés representa la conexión entre la tierra y el cielo, entre lo terrenal y lo espiritual, cualidades que definen la esencia marense.',
                virtues: ['Mirador panorámico excepcional', 'Senderos naturales', 'Biodiversidad endémica', 'Conexión espiritual con la naturaleza'],
                img: 'img/cerro-san-andres.jpg'
            },
            {
                id: 9,
                name: 'El Río Cachiri',
                type: 'playa',
                lat: 10.88000,
                lon: -71.80000,
                desc: 'Curso de agua que serpentea por el municipio, vital para la vida local.',
                context: 'El Río Cachiri es la arteria vital que nutre la vida en el Municipio Mara. Sus aguas cristalinas serpentean por el territorio, creando ecosistemas ribereños ricos en biodiversidad. A lo largo de sus orillas crecen especies vegetales que dependen de sus aguas, mientras que peces y aves acuáticas encuentran en él su hábitat natural. El río ha sido testigo de generaciones de marenses que han dependido de sus aguas para la agricultura, la pesca y la vida cotidiana. El Río Cachiri representa la vida, la fertilidad y la continuidad, siendo un símbolo del flujo constante de la historia y la cultura marense.',
                virtues: ['Ecosistema ribereño rico', 'Biodiversidad acuática', 'Vital para la agricultura local', 'Paisaje sereno y relajante'],
                img: 'img/rio-cachiri.jpg'
            },
            {
                id: 10,
                name: 'Juyasirrain',
                type: 'cultura',
                lat: 10.90000,
                lon: -71.76000,
                desc: 'Sitio arqueológico y cultural que preserva la historia ancestral de Mara.',
                context: 'Juyasirrain es un sitio sagrado que guarda los secretos más profundos de la historia ancestral del Municipio Mara. Este lugar arqueológico y cultural es testimonio de las civilizaciones que habitaron estas tierras mucho antes de la llegada de los europeos. Aquí se encuentran petroglifos, restos de cerámica y estructuras que hablan de una cultura rica y compleja. Juyasirrain es un lugar de peregrinación espiritual donde los descendientes de los pueblos originarios mantienen vivas sus tradiciones y rituales. Este sitio representa la memoria viva de Mara, la conexión con los ancestros y la preservación de una identidad cultural que trasciende el tiempo.',
                virtues: ['Sitio arqueológico único', 'Patrimonio cultural ancestral', 'Petroglifos y arte rupestre', 'Conexión espiritual con los ancestros'],
                img: 'img/juyasirrain.jpg'
            }
        ];

        // Variables globales
        let map = null;
        let markers = {};
        let isDarkMode = true;
        let itinerary = []; // Array para almacenar destinos del itinerario


        // Función para inicializar el mapa (ya no se usa en la pantalla principal)
        function initMap() {
            // Esta función ya no es necesaria para la pantalla principal
            // Los mapas se crean dinámicamente en los modales
            console.log('Mapa principal removido - se crean mapas dinámicos en modales');
            return true;
        }

        // Función eliminada - ya no se necesita itinerario

        // Función para renderizar destinos
        function renderDestinations(list) {
            const container = document.getElementById('destinations');
            
            if (!list || list.length === 0) {
                container.innerHTML = '<div class="empty-state">No se encontraron destinos</div>';
                return;
            }

            container.innerHTML = '';
            
            list.forEach(dest => {
                // Validar datos del destino
                if (!dest.id || !dest.name || !dest.lat || !dest.lon) {
                    console.warn('Destino con datos incompletos:', dest);
                    return;
                }

                const destEl = document.createElement('div');
                destEl.className = 'dest';
                destEl.draggable = true;
                destEl.dataset.id = dest.id;
                destEl.setAttribute('role', 'listitem');
                destEl.setAttribute('aria-label', `Destino: ${dest.name}`);

                destEl.innerHTML = `
                    <div style="position: relative;">
                        <img src="${dest.img}" alt="${dest.name}" 
                             style="cursor: pointer;"
                             onclick="showDestinationContext(${dest.id})"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjMzMzIi8+CjxwYXRoIGQ9Ik0zMiAyMEMzNi40MTgzIDIwIDQwIDE2LjQxODMgNDAgMTJDNDAgNy41ODE3MiAzNi40MTgzIDQgMzIgNEMyNy41ODE3IDQgMjQgNy41ODE3MiAyNCAxMkMyNCAxNi40MTgzIDI3LjU4MTcgMjAgMzIgMjBaIiBmaWxsPSIjNjY2Ii8+CjxwYXRoIGQ9Ik0zMiAzNkMzNi40MTgzIDM2IDQwIDMyLjQxODMgNDAgMjhDNDAgMjMuNTgxNyAzNi40MTgzIDIwIDMyIDIwQzI3LjU4MTcgMjAgMjQgMjMuNTgxNyAyNCAyOEMyNCAzMi40MTgzIDI3LjU4MTcgMzYgMzIgMzZaIiBmaWxsPSIjOTk5Ii8+CjxwYXRoIGQ9Ik0zMiA1MkMzNi40MTgzIDUyIDQwIDQ4LjQxODMgNDAgNDRDNDAgMzkuNTgxNyAzNi40MTgzIDM2IDMyIDM2QzI3LjU4MTcgMzYgMjQgMzkuNTgxNyAyNCA0NEMyNCA0OC40MTgzIDI3LjU4MTcgNTIgMzIgNTJaIiBmaWxsPSIjY2NjIi8+Cjwvc3ZnPgo='"/>
                        <div style="position: absolute; top: 2px; right: 2px; background: var(--accent1); color: #041017; 
                                    border-radius: 50%; width: 16px; height: 16px; display: flex; align-items: center; 
                                    justify-content: center; font-size: 10px; font-weight: bold;">📖</div>
                    </div>
                    <div class="meta">
                        <h4 style="cursor: pointer;" onclick="showDestinationContext(${dest.id})" title="Haz clic para ver más información">${dest.name}</h4>
                        <p>${dest.desc}</p>
                        <div style="margin-top:8px">
                            <button class="go-btn" data-id="${dest.id}" 
                                    aria-label="Ir a ${dest.name}"
                                    onclick="goToDestination(${dest.id})">
                                🗺️ Ir al Lugar
                            </button>
                        </div>
                    </div>
                `;

                // Eventos de arrastre
                destEl.addEventListener('dragstart', (e) => {
                    try {
                        e.dataTransfer.setData('text/plain', dest.id.toString());
                        e.dataTransfer.effectAllowed = 'copy';
                        destEl.classList.add('grab');
                    } catch (error) {
                        console.error('Error en dragstart:', error);
                    }
                });

                destEl.addEventListener('dragend', () => {
                    destEl.classList.remove('grab');
                });

                container.appendChild(destEl);

                // Preview al hacer hover (sin mapa)
                destEl.addEventListener('mouseover', () => {
                    try {
                        document.getElementById('preview').innerHTML = 
                            `<strong>${dest.name}</strong><div style="font-size:13px;color:var(--muted)">${dest.desc}</div>`;
                    } catch (error) {
                        console.error('Error en mouseover:', error);
                    }
                });

                destEl.addEventListener('mouseout', () => {
                    try {
                        document.getElementById('preview').innerHTML = 'Vista previa del destino';
                    } catch (error) {
                        console.error('Error en mouseout:', error);
                    }
                });
            });
        }


        // Función para mostrar contexto de destino con mapa
        function showDestinationContext(destId) {
            const dest = destinations.find(d => d.id === destId);
            if (!dest) return;

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 10px;
                overflow-y: auto;
            `;
            
            modal.innerHTML = `
                <div class="modal-content" style="background: var(--card); border-radius: 15px; padding: 20px; 
                           max-width: 900px; width: 100%; max-height: 95vh; overflow-y: auto; 
                           border: 1px solid var(--glass-2); position: relative;
                           margin: 10px;">
                    <button class="modal-close" onclick="this.parentElement.parentElement.remove()" 
                            style="position: absolute; top: 10px; right: 10px; 
                                   background: var(--accent1); color: #041017; border: none; 
                                   border-radius: 50%; width: 35px; height: 35px; cursor: pointer; 
                                   font-size: 18px; z-index: 10001;">×</button>
                    
                    <h2 style="color: var(--accent1); margin-top: 0; margin-right: 40px; font-size: 20px;">${dest.name}</h2>
                    
                    <div class="modal-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <!-- Información del destino -->
                        <div>
                            <div style="margin-bottom: 20px;">
                                <img src="${dest.img}" alt="${dest.name}" 
                                     style="width: 100%; height: 200px; object-fit: cover; border-radius: 10px;"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM2NjYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZW4gbm8gZGlzcG9uaWJsZTwvdGV4dD4KPC9zdmc+Cg=='"/>
                            </div>
                            
                            <h3 style="color: var(--accent2);">📖 Contexto Histórico y Cultural</h3>
                            <p style="line-height: 1.6; margin-bottom: 20px;">${dest.context}</p>
                            
                            <h3 style="color: var(--accent2);">✨ Virtudes y Atractivos</h3>
                            <div style="display: grid; gap: 8px; margin-bottom: 20px;">
                                ${dest.virtues.map(virtue => `
                                    <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 6px; 
                                                border-left: 3px solid var(--accent1); font-size: 13px;">
                                        <span style="color: var(--accent2);">✓</span> ${virtue}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Mapa del destino -->
                        <div>
                            <h3 style="color: var(--accent2); margin-top: 0;">🗺️ Ubicación</h3>
                            <div id="modal-map-${destId}" class="modal-map" style="width: 100%; height: 300px; border-radius: 10px; border: 1px solid var(--glass-2);"></div>
                            <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                <p style="margin: 0; font-size: 12px; color: var(--muted);">
                                    <strong>Coordenadas:</strong> ${dest.lat.toFixed(6)}, ${dest.lon.toFixed(6)}<br>
                                    <strong>Tipo:</strong> ${dest.type.charAt(0).toUpperCase() + dest.type.slice(1)}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-2);">
                        <button onclick="goToDestination(${dest.id})" 
                                style="background: linear-gradient(90deg, #10b981, #059669); 
                                       color: white; border: none; padding: 12px 24px; 
                                       border-radius: 25px; cursor: pointer; font-weight: bold; margin-right: 10px;">
                            🗺️ Ir al Lugar
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: var(--glass); color: inherit; border: 1px solid rgba(255,255,255,0.1); 
                                       padding: 12px 24px; border-radius: 25px; cursor: pointer;">
                            Cerrar
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Inicializar mapa en el modal
            setTimeout(() => {
                try {
                    if (typeof L !== 'undefined') {
                        const modalMap = L.map(`modal-map-${destId}`, { 
                            zoomControl: true,
                            attributionControl: true
                        }).setView([dest.lat, dest.lon], 13);
                        
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '© OpenStreetMap contributors',
                            maxZoom: 18
                        }).addTo(modalMap);
                        
                        L.marker([dest.lat, dest.lon])
                            .addTo(modalMap)
                            .bindPopup(`<strong>${dest.name}</strong><br>${dest.desc}`)
                            .openPopup();
                    }
                } catch (error) {
                    console.error('Error creando mapa en modal:', error);
                    document.getElementById(`modal-map-${destId}`).innerHTML = 
                        '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted)">Error cargando mapa</div>';
                }
            }, 100);
        }

        // Función para ir al destino en Google Maps
        function goToDestination(destId) {
            try {
                const dest = destinations.find(d => d.id === destId);
                if (!dest) {
                    console.error('Destino no encontrado:', destId);
                    return;
                }

                // Construir URL de Google Maps con direcciones
                const mapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${dest.lat},${dest.lon}&travelmode=driving`;
                
                // Abrir en nueva pestaña
                window.open(mapsUrl, '_blank');
                
                console.log(`Navegando a ${dest.name} en Google Maps`);
                
            } catch (error) {
                console.error('Error abriendo Google Maps:', error);
                alert('Error al abrir Google Maps. Por favor, inténtalo de nuevo.');
            }
        }

        // Función para mostrar videos temáticos
        function showThemeVideo(type) {
            try {
                const videoContainer = document.getElementById('theme-video-container');
                const videoTitle = document.getElementById('theme-video-title');
                const videoDesc = document.getElementById('theme-video-desc');
                const video = document.getElementById('theme-video');
                const videoMp4 = document.getElementById('theme-video-mp4');
                const videoWebm = document.getElementById('theme-video-webm');
                const videoOgg = document.getElementById('theme-video-ogg');
                const videoDownload = document.getElementById('theme-video-download');

                // Configuración de videos por tipo
                const videoConfig = {
                    'montana': {
                        title: '🌿 Flora y Fauna de Mara',
                        desc: 'Descubre la biodiversidad única de los ecosistemas marenses',
                        mp4: 'videos/flora-fauna-mara.mp4',
                        webm: 'videos/flora-fauna-mara.webm',
                        ogg: 'videos/flora-fauna-mara.ogg'
                    },
                    'cultura': {
                        title: '🎭 Cultura y Tradiciones de Mara',
                        desc: 'Conoce las tradiciones ancestrales y la cultura viva marense',
                        mp4: 'videos/cultura-mara.mp4',
                        webm: 'videos/cultura-mara.webm',
                        ogg: 'videos/cultura-mara.ogg'
                    }
                };

                // Si es un tipo con video, mostrarlo
                if (videoConfig[type]) {
                    const config = videoConfig[type];
                    
                    videoTitle.textContent = config.title;
                    videoDesc.textContent = config.desc;
                    
                    // Configurar fuentes de video
                    videoMp4.src = config.mp4;
                    videoWebm.src = config.webm;
                    videoOgg.src = config.ogg;
                    videoDownload.href = config.mp4;
                    
                    // Recargar el video para que tome las nuevas fuentes
                    video.load();
                    
                    // Mostrar el contenedor
                    videoContainer.style.display = 'block';
                    
                    console.log(`Mostrando video temático para: ${type}`);
                } else {
                    // Ocultar el contenedor para otros tipos
                    videoContainer.style.display = 'none';
                }
            } catch (error) {
                console.error('Error mostrando video temático:', error);
            }
        }

        // Event listeners
        function setupEventListeners() {
            // Filtros
            document.getElementById('filters').addEventListener('click', (e) => {
                try {
                    const chip = e.target.closest('.chip');
                    if (!chip) return;

                    // Actualizar chip activo
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');

                    const type = chip.dataset.type;
                    const query = document.getElementById('search').value.toLowerCase();
                    const filtered = destinations.filter(dest => 
                        (type === 'todo' || dest.type === type) && 
                        (dest.name.toLowerCase().includes(query) || dest.desc.toLowerCase().includes(query))
                    );
                    renderDestinations(filtered);
                    
                    // Mostrar video temático para ciertos filtros
                    showThemeVideo(type);
                } catch (error) {
                    console.error('Error en filtros:', error);
                }
            });

            // Búsqueda
            document.getElementById('search').addEventListener('input', () => {
                try {
                    document.getElementById('filters').querySelector('.chip[data-type="todo"]').click();
                } catch (error) {
                    console.error('Error en búsqueda:', error);
                }
            });

            // Botón sugerir
            document.getElementById('btn-random').addEventListener('click', () => {
                try {
                    const pick = destinations[Math.floor(Math.random() * destinations.length)];
                    alert(`Sugerencia: ${pick.name}\n\n${pick.desc}`);
                } catch (error) {
                    console.error('Error en sugerencia aleatoria:', error);
                    alert('No se pudo generar una sugerencia en este momento.');
                }
            });

            // Los destinos ahora son solo informativos, sin funcionalidad de itinerario

            // Exportar itinerario (abrir modal)
            document.getElementById('btn-download').addEventListener('click', () => {
                try {
                    // Mostrar modal de exportación
                    document.getElementById('export-modal').style.display = 'block';
                } catch (error) {
                    console.error('Error abriendo modal de exportación:', error);
                    alert('No se pudo abrir el formulario de exportación. Inténtalo de nuevo.');
                }
            });

            // Mostrar historia de Mara
            document.getElementById('btn-history').addEventListener('click', () => {
                try {
                    document.getElementById('history-modal').style.display = 'block';
                } catch (error) {
                    console.error('Error mostrando historia:', error);
                }
            });

            // Cerrar modal de historia
            document.getElementById('close-history').addEventListener('click', () => {
                try {
                    document.getElementById('history-modal').style.display = 'none';
                } catch (error) {
                    console.error('Error cerrando historia:', error);
                }
            });

            // Cerrar modal al hacer clic fuera
            document.getElementById('history-modal').addEventListener('click', (e) => {
                if (e.target.id === 'history-modal') {
                    document.getElementById('history-modal').style.display = 'none';
                }
            });

            // Event listeners para modal de exportación
            document.getElementById('close-export').addEventListener('click', () => {
                document.getElementById('export-modal').style.display = 'none';
            });

            document.getElementById('cancel-export').addEventListener('click', () => {
                document.getElementById('export-modal').style.display = 'none';
            });

            // Cerrar modal de exportación al hacer clic fuera
            document.getElementById('export-modal').addEventListener('click', (e) => {
                if (e.target.id === 'export-modal') {
                    document.getElementById('export-modal').style.display = 'none';
                }
            });

            // La imagen estática ya está configurada en el HTML

            // Generar PDF
            document.getElementById('export-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Mostrar indicador de carga
                const btn = document.getElementById('generate-pdf');
                const originalText = btn.textContent;
                btn.textContent = '⏳ Generando PDF...';
                btn.disabled = true;
                
                try {
                    await generatePDF();
                } catch (error) {
                    console.error('Error en generatePDF:', error);
                    alert('Error generando el PDF. Por favor, inténtalo de nuevo.');
                } finally {
                    // Restaurar botón
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            });

            // Cambiar tema
            document.getElementById('btn-theme').addEventListener('click', () => {
                try {
                    isDarkMode = !isDarkMode;
                    const btn = document.getElementById('btn-theme');
                    
                    if (isDarkMode) {
                        document.documentElement.style.setProperty('--bg', '#0f1724');
                        document.documentElement.style.setProperty('--card', '#0b1220');
                        document.documentElement.style.setProperty('--muted', 'rgba(255,255,255,0.6)');
                        btn.textContent = 'Modo Claro';
                    } else {
                        document.documentElement.style.setProperty('--bg', '#f7fafc');
                        document.documentElement.style.setProperty('--card', '#ffffff');
                        document.documentElement.style.setProperty('--muted', 'rgba(0,0,0,0.6)');
                        btn.textContent = 'Modo Oscuro';
                    }
                } catch (error) {
                    console.error('Error cambiando tema:', error);
                }
            });

            // Atajos de teclado
            document.addEventListener('keydown', (e) => {
                try {
                    // Cerrar modal de video intro con Escape
                    if (e.key === 'Escape') {
                        const introModal = document.getElementById('intro-video-modal');
                        if (introModal && introModal.style.display !== 'none') {
                            closeIntroVideo();
                            return;
                        }
                        
                        // Limpiar búsqueda si no hay modal abierto
                        document.getElementById('search').value = '';
                        document.getElementById('filters').querySelector('.chip[data-type="todo"]').click();
                    }
                    
                    if (e.key === 'Enter' && e.ctrlKey) {
                        const first = destinations[0];
                        if (first) {
                            goToDestination(first.id);
                        }
                    }
                } catch (error) {
                    console.error('Error en atajo de teclado:', error);
                }
            });
        }

        // Función para cerrar el modal de video intro
        function closeIntroVideo() {
            try {
                const modal = document.getElementById('intro-video-modal');
                const video = document.getElementById('intro-video');
                
                // Pausar el video
                if (video) {
                    video.pause();
                    video.currentTime = 0;
                }
                
                // Ocultar el modal
                if (modal) {
                    modal.style.display = 'none';
                }
                
                console.log('Modal de video intro cerrado');
            } catch (error) {
                console.error('Error cerrando modal de video intro:', error);
            }
        }

        // Función para generar PDF del itinerario
        async function generatePDF() {
            try {
                // Obtener datos del formulario
                const formData = {
                    departureTime: document.getElementById('departure-time').value,
                    departureLocation: document.getElementById('departure-location').value,
                    returnTime: document.getElementById('return-time').value,
                    returnLocation: document.getElementById('return-location').value,
                    institution: document.getElementById('institution').value,
                    responsible: document.getElementById('responsible').value,
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value,
                    imageSrc: document.getElementById('pdf-image').src
                };

                // Validar datos requeridos
                if (!formData.departureTime || !formData.departureLocation || 
                    !formData.returnTime || !formData.returnLocation ||
                    !formData.institution || !formData.responsible || 
                    !formData.phone || !formData.email) {
                    alert('Por favor, completa todos los campos requeridos.');
                    return;
                }

                // Crear PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Configurar colores
                const primaryColor = [255, 107, 107]; // #ff6b6b
                const secondaryColor = [107, 255, 217]; // #6bffd9
                const darkColor = [15, 23, 36]; // #0f1724

                // Agregar imagen configurable al principio
                const addImageToPDF = () => {
                    return new Promise((resolve) => {
                        try {
                            const img = new Image();
                            img.crossOrigin = 'anonymous';
                            
                            img.onload = function() {
                                try {
                                    const canvas = document.createElement('canvas');
                                    const maxWidth = 100;
                                    const maxHeight = 60;
                                    let width = img.naturalWidth || img.width;
                                    let height = img.naturalHeight || img.height;
                                    
                                    if (width > maxWidth) {
                                        height = (height * maxWidth) / width;
                                        width = maxWidth;
                                    }
                                    if (height > maxHeight) {
                                        width = (width * maxHeight) / height;
                                        height = maxHeight;
                                    }
                                    
                                    canvas.width = Math.max(1, Math.floor(width));
                                    canvas.height = Math.max(1, Math.floor(height));
                                    const ctx = canvas.getContext('2d');
                                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                                    
                                    let dataUrl = '';
                                    try {
                                        dataUrl = canvas.toDataURL('image/jpeg', 0.92);
                                    } catch (_) {
                                        dataUrl = canvas.toDataURL('image/png');
                                    }
                                    
                                    // Insertar imagen en la esquina superior derecha
                                    doc.addImage(dataUrl, 'JPEG', 150, 10, canvas.width, canvas.height);
                                    console.log('Imagen agregada al PDF correctamente');
                                    resolve();
                                } catch (imgError) {
                                    console.warn('No se pudo incrustar la imagen:', imgError);
                                    resolve();
                                }
                            };
                            
                            img.onerror = function(err) {
                                console.warn('Error cargando imagen:', err);
                                resolve();
                            };
                            
                            img.src = formData.imageSrc;
                        } catch (outerErr) {
                            console.error('Error procesando imagen:', outerErr);
                            resolve();
                        }
                    });
                };
                
                // Procesar imagen de forma asíncrona
                console.log('Cargando imagen para el PDF...');
                await addImageToPDF();
                console.log('Imagen procesada, continuando con el PDF...');

                // Título principal
                doc.setFontSize(20);
                doc.setTextColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.text('ITINERARIO DE TURISMO', 105, 20, { align: 'center' });
                doc.text('MUNICIPIO MARA', 105, 30, { align: 'center' });

                // Línea decorativa
                doc.setDrawColor(primaryColor[0], primaryColor[1], primaryColor[2]);
                doc.setLineWidth(2);
                doc.line(20, 35, 190, 35);

                // Información del itinerario
                doc.setFontSize(14);
                doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
                doc.text('INFORMACIÓN DEL ITINERARIO', 20, 50);

                doc.setFontSize(12);
                doc.text(`Hora de Salida: ${formData.departureTime}`, 20, 60);
                doc.text(`Lugar de Salida: ${formData.departureLocation}`, 20, 70);
                doc.text(`Hora de Retorno: ${formData.returnTime}`, 20, 80);
                doc.text(`Lugar de Retorno: ${formData.returnLocation}`, 20, 90);

                // Información institucional
                doc.setFontSize(14);
                doc.text('INFORMACIÓN INSTITUCIONAL', 20, 110);

                doc.setFontSize(12);
                doc.text(`Institución: ${formData.institution}`, 20, 120);
                doc.text(`Encargado: ${formData.responsible}`, 20, 130);
                doc.text(`Teléfono: ${formData.phone}`, 20, 140);
                doc.text(`Correo: ${formData.email}`, 20, 150);

                // Destinos disponibles
                let yPosition = 170;
                doc.setFontSize(14);
                doc.text('DESTINOS TURÍSTICOS DISPONIBLES', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.setTextColor(darkColor[0], darkColor[1], darkColor[2]);
                doc.text('El Municipio Mara ofrece una gran variedad de destinos turísticos:', 20, yPosition);
                yPosition += 15;
                
                // Listar destinos principales
                const mainDestinations = destinations.slice(0, 8);
                mainDestinations.forEach((dest, index) => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text(`• ${dest.name}`, 25, yPosition);
                    doc.text(`  ${dest.desc}`, 25, yPosition + 8);
                    
                    yPosition += 20;
                });

                // Pie de página
                try {
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Municipio Mara - Turismo y Cultura', 20, yPosition + 20);
                    doc.text('Zulia - Venezuela', 20, yPosition + 30);
                    doc.text(`Generado el: ${new Date().toLocaleDateString()}`, 20, yPosition + 40);
                } catch (error) {
                    console.log('Continuando sin pie de página');
                }
                
                // Guardar PDF
                doc.save(`itinerario-mara-${new Date().toISOString().split('T')[0]}.pdf`);
                
                // Cerrar modal
                document.getElementById('export-modal').style.display = 'none';
                
                // Feedback visual
                const btn = document.getElementById('btn-download');
                const originalText = btn.textContent;
                btn.textContent = '✓ PDF Generado';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);

            } catch (error) {
                console.error('Error generando PDF:', error);
                
                // Fallback: generar archivo de texto
                try {
                    generateTextFile(formData);
                } catch (textError) {
                    console.error('Error generando archivo de texto:', textError);
                    alert('Error generando el documento. Por favor, inténtalo de nuevo.');
                }
            }
        }

        // Función de respaldo para generar archivo de texto
        function generateTextFile(formData) {
            try {
                let content = 'ITINERARIO DE TURISMO - MUNICIPIO MARA\n';
                content += '='.repeat(50) + '\n\n';
                
                content += 'INFORMACIÓN DEL ITINERARIO\n';
                content += '-'.repeat(30) + '\n';
                content += `Hora de Salida: ${formData.departureTime}\n`;
                content += `Lugar de Salida: ${formData.departureLocation}\n`;
                content += `Hora de Retorno: ${formData.returnTime}\n`;
                content += `Lugar de Retorno: ${formData.returnLocation}\n\n`;
                
                content += 'INFORMACIÓN INSTITUCIONAL\n';
                content += '-'.repeat(30) + '\n';
                content += `Institución: ${formData.institution}\n`;
                content += `Encargado: ${formData.responsible}\n`;
                content += `Teléfono: ${formData.phone}\n`;
                content += `Correo: ${formData.email}\n\n`;
                
                content += 'DESTINOS TURÍSTICOS DISPONIBLES\n';
                content += '-'.repeat(30) + '\n';
                content += 'El Municipio Mara ofrece una gran variedad de destinos turísticos:\n\n';
                
                destinations.slice(0, 8).forEach((dest, index) => {
                    content += `• ${dest.name}\n`;
                    content += `  ${dest.desc}\n\n`;
                });
                
                content += 'MUNICIPIO MARA - Turismo y Cultura\n';
                content += 'Zulia - Venezuela\n';
                content += 'Ruta Turística\n\n';
                content += `Generado el: ${new Date().toLocaleDateString()}\n`;
                
                // Crear y descargar archivo de texto
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `itinerario-mara-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Cerrar modal
                document.getElementById('export-modal').style.display = 'none';
                
                // Feedback visual
                const btn = document.getElementById('btn-download');
                const originalText = btn.textContent;
                btn.textContent = '✓ Archivo Generado';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
                
                console.log('Archivo de texto generado como respaldo');
            } catch (error) {
                console.error('Error generando archivo de texto:', error);
                throw error;
            }
        }

        // Función para configurar el modal de video intro
        function setupIntroVideo() {
            try {
                const modal = document.getElementById('intro-video-modal');
                const video = document.getElementById('intro-video');
                const closeBtn = document.getElementById('close-intro-video');
                const skipBtn = document.getElementById('skip-intro-video');
                const continueBtn = document.getElementById('continue-intro-video');

                // Event listener para cerrar con el botón X
                if (closeBtn) {
                    closeBtn.addEventListener('click', closeIntroVideo);
                }

                // Event listener para saltar video
                if (skipBtn) {
                    skipBtn.addEventListener('click', closeIntroVideo);
                }

                // Event listener para continuar después del video
                if (continueBtn) {
                    continueBtn.addEventListener('click', closeIntroVideo);
                }

                // Event listener para cerrar al hacer clic fuera del modal
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            closeIntroVideo();
                        }
                    });
                }

                // Event listener para cerrar cuando el video termine
                if (video) {
                    video.addEventListener('ended', () => {
                        // Mostrar botón de continuar más prominente
                        if (continueBtn) {
                            continueBtn.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                            continueBtn.style.transform = 'scale(1.05)';
                            continueBtn.textContent = '🎉 ¡Continuar Explorando!';
                        }
                    });

                    // Event listener para errores de video
                    video.addEventListener('error', () => {
                        console.warn('Error cargando video intro, ocultando modal');
                        closeIntroVideo();
                    });
                }

                console.log('Modal de video intro configurado');
            } catch (error) {
                console.error('Error configurando modal de video intro:', error);
            }
        }

        // Inicialización principal
        function initializeApp() {
            try {
                console.log('Inicializando aplicación de turismo...');

                // Configurar modal de video intro
                setupIntroVideo();

                // Renderizar destinos
                renderDestinations(destinations);
                
                // Configurar event listeners
                setupEventListeners();

                // Ocultar indicador de carga
                const loadingEl = document.getElementById('loading');
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }

                console.log('Aplicación inicializada correctamente');

            } catch (error) {
                console.error('Error inicializando aplicación:', error);
                
                // Mostrar error en pantalla
                const loadingEl = document.getElementById('loading');
                if (loadingEl) {
                    loadingEl.innerHTML = `
                        <div style="text-align:center;color:#ff6b6b">
                            <h3>Error cargando la aplicación</h3>
                            <p>Por favor, recarga la página</p>
                            <button onclick="location.reload()" style="margin-top:10px;padding:10px 20px;background:#ff6b6b;color:white;border:none;border-radius:5px;cursor:pointer">
                                Recargar Página
                            </button>
                        </div>
                    `;
                }
            }
        }

        // Inicializar cuando la página esté lista
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>